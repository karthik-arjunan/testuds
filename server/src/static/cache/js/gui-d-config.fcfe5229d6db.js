// Generated by CoffeeScript 1.12.7
(function() {
  gui.configuration = new BasicGuiElement("Clear cache");

  gui.configuration.link = function() {
    "use strict";
    if (api.config.admin === false) {
      return;
    }
    api.templates.get("configuration", function(tmpl) {
      api.configuration.overview((function(data) {
        var $element, element, j, len, ref, val;
        gui.doLog(data);
        gui.clearWorkspace();
        gui.appendToWorkspace(api.templates.evaluate(tmpl, {
          config: data
        }));
        gui.setLinksEvents();
        gui.tools.applyCustoms("#form_config");
        ref = $("#form_config .config-ctrl");
        for (j = 0, len = ref.length; j < len; j++) {
          element = ref[j];
          $element = $(element);
          val = $element.attr('type') === 'checkbox' ? ($element.is(":checked") ? "1" : "0") : $element.val();
          $element.attr("data-val", val);
        }
        $("#form_config .button-undo").on("click", function(event) {
          var fld;
          fld = $(this).attr("data-fld");
          gui.doLog(fld, $("#" + fld).val());
          $("#" + fld).val($("#" + fld).attr("data-val"));
        });
        $("#form_config .button-save").on("click", function(event) {
          var cfg, i, k, key, len1, ref1, section;
          cfg = {};
          ref1 = $("#form_config .config-ctrl");
          for (i = k = 0, len1 = ref1.length; k < len1; i = ++k) {
            element = ref1[i];
            $element = $(element);
            val = $element.attr('type') === 'checkbox' ? ($element.is(":checked") ? "1" : "0") : $element.val();
            if ($element.attr("data-val") !== val) {
              section = $element.attr("data-section");
              key = $element.attr("data-key");
              if (cfg[section] == null) {
                cfg[section] = {};
              }
              cfg[section][key] = {
                value: val
              };
            }
          }
          gui.doLog(cfg);
          if (!$.isEmptyObject(cfg)) {
            api.configuration.save(cfg, (function() {
              gui.showDashboard();
              gui.notify(gettext("Configuration saved"), "success");
            }), gui.failRequestModalFnc);
          } else {
            gui.showDashboard();
            gui.notify(gettext("No changes has been made"), "success");
            return;
          }
        });
      }), gui.failRequestModalFnc);
    });
  };

}).call(this);
